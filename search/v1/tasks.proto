syntax = "proto3";

package search.v1;

import "shared/v1/struct.proto";
import "shared/v1/time.proto";
import "shared/v1/wrappers.proto";

option cc_enable_arenas = true;
option go_package = "github.com/ahmad-khatib0-org/megacommerce-proto/gen/go/search/v1;v1";
option java_outer_classname = "TasksProto";
option java_package = "org.megacommerce.search.v1";

// Minimal task-create / add-documents response
message TaskCreateResponse {
  // Meili returns a numeric task id (examples show "taskUid"). Use uint64.
  uint64 task_uid = 1 [json_name = "taskUid"];

  // index uid string
  string index_uid = 2 [json_name = "indexUid"];

  // status e.g. "enqueued", "processing", "succeeded", "failed"
  string status = 3;

  // type e.g. "documentAdditionOrUpdate"
  string type = 4;

  // enqueuedAt is returned as an RFC3339 string in JSON. Use Timestamp for typed time.
  shared.v1.Timestamp enqueued_at = 5 [json_name = "enqueuedAt"];
}

message TaskGetResponse {
  // JSON: "uid": 1
  uint64 uid = 1 [json_name = "uid"];

  // JSON: "indexUid": "movies"
  string index_uid = 2 [json_name = "indexUid"];

  // JSON: "status": "succeeded"
  string status = 3 [json_name = "status"];

  // JSON: "type": "settingsUpdate"
  string type = 4 [json_name = "type"];

  // JSON: "canceledBy": null  (or integer)
  shared.v1.UInt64Value canceled_by = 5 [json_name = "canceledBy"];

  // JSON: "details": { "rankingRules": [...] }
  shared.v1.Struct details = 6 [json_name = "details"];

  // JSON: "error": null  (or object)
  TaskGetResponseError error = 7 [json_name = "error"];

  // JSON: "duration": "PT1S"  (ISO 8601 duration string)
  string duration = 8 [json_name = "duration"];

  // JSON RFC3339 timestamps -> protobuf Timestamp
  shared.v1.Timestamp enqueued_at = 9 [json_name = "enqueuedAt"];
  shared.v1.Timestamp started_at = 10 [json_name = "startedAt"];
  shared.v1.Timestamp finished_at = 11 [json_name = "finishedAt"];
}

message TaskGetResponseError {
  string message = 1 [json_name = "message"];
  string code = 2 [json_name = "code"];
  string type = 3 [json_name = "type"];
  string link = 4 [json_name = "link"];
  shared.v1.Struct details = 5 [json_name = "details"];
}

// Task object for a delete-one-document request (type = "documentDeletion")
message TaskDeleteResponse {
  uint64 task_uid = 1 [json_name = "taskUid"];
  string index_uid = 2 [json_name = "indexUid"];
  string status = 3 [json_name = "status"];
  string type = 4 [json_name = "type"];
  shared.v1.Timestamp enqueued_at = 5 [json_name = "enqueuedAt"];
}
